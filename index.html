<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitxes Grups - Tink Ànsies</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --yellow: #ff0000;
      --yellow-soft: #ff4569;
      --bg: #000000;
      --bg-soft: #111111;
      --accent: #ff1744;
      --accent-2: #ff8a80;
      --card: #161616;
      --border-soft: rgba(255, 255, 255, 0.1);
      --text-main: #ffffff;
      --muted: #bbbbbb;
      --danger: #ff5252;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #000000;
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    #root {
      min-height: 100vh;
    }

    .app-shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem 1.25rem 3rem;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 0.75rem 1rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: radial-gradient(circle at top left, rgba(255, 0, 0, 0.18), transparent 60%),
                  rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(14px);
      position: sticky;
      top: 0.5rem;
      z-index: 20;
    }

    .top-left {
      display: flex;
      align-items: center;
      gap: 0.85rem;
    }

    .top-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 2px solid rgba(255, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 0%, rgba(255, 0, 0, 0.9), rgba(120, 0, 0, 0.4));
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.9), 0 0 18px rgba(255, 0, 0, 0.7);
      overflow: hidden;
    }

    .top-logo img {
      width: 26px;
      height: 26px;
      object-fit: contain;
    }

    .top-title {
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .top-badge {
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .top-nav {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .top-nav-btn {
      background: transparent;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      padding: 0.4rem 0.8rem;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.16s ease-out;
    }

    .top-nav-btn span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.45);
    }

    .top-nav-btn.active {
      background: rgba(255, 0, 0, 0.18);
      border-color: rgba(255, 0, 0, 0.9);
      color: #ffe4e4;
      box-shadow: 0 0 14px rgba(255, 0, 0, 0.4);
    }

    .top-nav-btn.active span.dot {
      background: #ff0000;
    }

    @media (max-width: 720px) {
      .top-bar {
        border-radius: 18px;
        flex-direction: column;
        align-items: flex-start;
      }
      .top-nav {
        width: 100%;
        justify-content: space-between;
      }
    }

    .page-wrap {
      margin-top: 1.25rem;
    }

    .home-hero {
      position: relative;
      margin-top: 0.75rem;
      min-height: min(520px, calc(100vh - 140px));
      border-radius: 26px;
      overflow: hidden;
      background-image: url("img/concert-bg.jpg");
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem 1.5rem;
      box-shadow:
        0 30px 80px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .home-hero-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(2px);
    }

    .home-hero-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      align-items: center;
      justify-content: center;
    }

    .home-hero-title {
      font-size: clamp(1.9rem, 4vw, 2.6rem);
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: #ffffff;
      text-shadow:
        0 0 18px rgba(0, 0, 0, 0.95),
        0 0 40px rgba(0, 0, 0, 1);
    }

    .home-hero-bursts {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
    }

    .home-hero-bursts .burst-main {
      font-size: 0.9rem;
      letter-spacing: 0.22em;
    }

    @media (max-width: 700px) {
      .home-hero {
        min-height: 380px;
        padding: 1.75rem 1.2rem;
      }

      .home-hero-title {
        font-size: 1.6rem;
        letter-spacing: 0.22em;
      }
    }

    .page-title {
      font-size: 1.4rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 0.3rem;
    }

    .page-sub {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .page-grid {
      margin-top: 1.25rem;
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      gap: 1.25rem;
    }

    @media (max-width: 900px) {
      .page-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.04), rgba(0, 0, 0, 0.95));
      border-radius: 20px;
      border: 1px solid var(--border-soft);
      padding: 1.1rem 1rem;
      box-shadow:
        0 18px 50px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .panel-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 0.75rem;
      color: var(--yellow-soft);
    }

    .panel p {
      margin: 0 0 0.3rem;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .panel p strong {
      color: #ffffff;
    }

    .burst-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .burst-btn {
      position: relative;
      width: 190px;
      height: 190px;
      cursor: pointer;
      transition: transform 0.15s ease, filter 0.15s ease;
      background: none;
      filter: drop-shadow(0 0 25px rgba(255, 0, 0, 0.7));
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .burst-btn-inner::before {
      content: "";
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 78%;
      aspect-ratio: 1 / 1;
      border-radius: 999px;
      background: #000000 url('icons/logo-tinkansies.png') center center / 80% no-repeat;
      opacity: 0.98;
    }

    .burst-btn-inner {
      position: absolute;
      inset: 26px;
      border-radius: 999px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0.4rem;
    }

    .burst-label {
      font-size: 0.72rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      opacity: 0.85;
    }

    .burst-main {
      font-size: 1.25rem;
      text-transform: uppercase;
      margin-top: 0.15rem;
      font-weight: 800;
      letter-spacing: 0.06em;
    }

    .burst-btn .burst-main {
      position: relative;
      z-index: 2;
      color: #ffffff;
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
      margin-top: 5.4rem;
    }


    .burst-btn:hover {
      transform: translateY(-3px) scale(1.02);
      filter: drop-shadow(0 0 35px rgba(255, 0, 0, 0.95));
    }

    .home-grid {
      margin-top: 1.5rem;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
      gap: 1.25rem;
    }

    @media (max-width: 900px) {
      .home-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .home-card {
      background: radial-gradient(circle at top left, rgba(255, 0, 0, 0.24), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(255, 64, 129, 0.12), transparent 55%),
                  #050505;
      border-radius: 22px;
      padding: 1.1rem 1rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 25px 50px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    .home-card h3 {
      margin-top: 0;
      margin-bottom: 0.4rem;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .home-card p {
      margin: 0;
      font-size: 0.86rem;
      color: var(--muted);
    }

    .home-card ul {
      margin: 0.7rem 0 0;
      padding-left: 1.1rem;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .home-card li + li {
      margin-top: 0.15rem;
    }

    .home-pills {
      margin-top: 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 0.18rem 0.6rem;
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .pill strong {
      color: #ffb3b3;
    }

    .home-footnote {
      margin-top: 1.2rem;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .form-group {
      margin-bottom: 0.8rem;
    }

    .form-row {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .form-group.half {
      flex: 1;
      min-width: 180px;
    }

    label {
      display: block;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 0.25rem;
      color: var(--muted);
    }

    input,
    textarea,
    select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(0, 0, 0, 0.75);
      padding: 0.55rem 0.8rem;
      color: #ffffff;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    textarea {
      border-radius: 14px;
      min-height: 80px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(255, 255, 255, 0.25);
    }

    input:focus,
    textarea:focus {
      border-color: rgba(255, 0, 0, 0.9);
      box-shadow: 0 0 0 1px rgba(255, 0, 0, 0.6);
      background: rgba(0, 0, 0, 0.95);
    }

    .hint {
      margin-top: 0.25rem;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .btn-row {
      display: flex;
      gap: 0.6rem;
      margin-top: 0.8rem;
      flex-wrap: wrap;
    }

    .btn-primary,
    .btn-ghost {
      border-radius: 999px;
      padding: 0.55rem 1.15rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      border: 1px solid transparent;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff0000, #ff9800);
      color: #000;
      box-shadow:
        0 12px 30px rgba(0, 0, 0, 0.8),
        0 0 18px rgba(255, 0, 0, 0.9);
    }

    .btn-primary:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      border-color: rgba(255, 255, 255, 0.24);
      color: var(--muted);
    }

    .btn-ghost:hover {
      border-color: rgba(255, 255, 255, 0.5);
      color: #ffffff;
    }

    .filters {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .pill-small {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: transparent;
      padding: 0.18rem 0.6rem;
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      cursor: pointer;
    }

    .pill-small.active {
      background: rgba(255, 0, 0, 0.28);
      border-color: rgba(255, 0, 0, 0.9);
    }

    .viewer-card {
      background:
        radial-gradient(circle at top left, rgba(255, 0, 0, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 255, 255, 0.06), transparent 55%),
        var(--card);
      border-radius: 18px;
      padding: 1.1rem;
      border: 1px solid rgba(255, 255, 255, 0.24);
      min-height: 240px;
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title {
      margin: 0;
      font-size: 1.6rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #ff0000;
    }

    .badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 0.1rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: var(--muted);
    }

    .badge.yellow {
      border-color: rgba(255, 0, 0, 0.9);
      color: #ffe4e4;
    }

    .fav-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      padding: 0.1rem 0.25rem;
      color: rgba(255, 255, 255, 0.4);
    }

    .fav-btn.active {
      color: #ff0000;
      text-shadow: 0 0 8px rgba(255, 0, 0, 0.9);
    }


    .fav-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      padding: 0.1rem 0.25rem;
      color: rgba(255, 255, 255, 0.4);
    }

    .fav-btn.active {
      color: #ff0000;
      text-shadow: 0 0 8px rgba(255, 0, 0, 0.9);
    }


    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.9rem;
      gap: 0.5rem;
    }

    .row-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.7rem;
      color: var(--muted);
    }

    .row-value {
      font-weight: 500;
    }

    .row-value.muted {
      color: var(--muted);
      font-style: italic;
    }

    .video-placeholder,
    .video-box {
      border-radius: 14px;
      border: 1px dashed rgba(255, 255, 255, 0.2);
      padding: 0.6rem 0.7rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .video-box iframe {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 10px;
      border: none;
    }

    .list-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.7rem;
      gap: 0.5rem;
    }

    .list-toolbar-main {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .nav-btn {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      background: #ff1744;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: 800;
      box-shadow: 0 0 18px rgba(255, 23, 68, 0.7);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .nav-btn:hover:not([disabled]) {
      transform: translateY(-1px) scale(1.05);
      box-shadow: 0 0 26px rgba(255, 23, 68, 0.9);
      background: #ff4569;
    }

    .nav-btn[disabled] {
      opacity: 0.35;
      cursor: default;
      box-shadow: none;
      background: #7f1a2c;
    }

    .delete-btn {
      border-radius: 999px;
      border: 1px solid rgba(255, 82, 82, 0.9);
      background: rgba(0, 0, 0, 0.92);
      color: #ff8a80;
      padding: 0.35rem 1rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      cursor: pointer;
    }

    .delete-btn:hover {
      background: rgba(255, 82, 82, 0.15);
    }

    .edit-btn {
      border-radius: 999px;
      border: 1px solid rgba(255, 0, 0, 0.9);
      background: rgba(0, 0, 0, 0.92);
      color: #ffe4e4;
      padding: 0.35rem 1rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      cursor: pointer;
    }

    .edit-btn:hover {
      box-shadow: 0 0 16px rgba(255, 0, 0, 0.85);
      background: rgba(255, 0, 0, 0.16);
    }

    .edit-form {
      margin-top: 0.6rem;
    }

    .edit-form .form-row {
      margin-bottom: 0.4rem;
    }

    .edit-form-actions {
      margin-top: 0.8rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .counter {
      font-variant-numeric: tabular-nums;
    }

    .filters-extra {
      margin-top: 0.6rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .filters-extra label {
      font-size: 0.68rem;
      letter-spacing: 0.16em;
    }

    .filters-extra select {
      max-width: 150px;
    }

    .share-btn {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      background: rgba(0, 0, 0, 0.95);
      padding: 0.4rem 1.1rem;
      font-size: 0.82rem;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.17em;
      cursor: pointer;
    }

    .share-btn:hover {
      border-color: rgba(255, 255, 255, 0.6);
    }

    .export-btn {
      border-radius: 999px;
      border: 1px solid rgba(64, 196, 255, 0.9);
      background: rgba(0, 0, 0, 0.96);
      color: #e1f5fe;
      padding: 0.4rem 1.1rem;
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.17em;
      cursor: pointer;
    }

    .export-btn:hover {
      box-shadow: 0 0 18px rgba(64, 196, 255, 0.65);
    }

    .no-bands {
      font-size: 0.85rem;
      color: var(--muted);
      font-style: italic;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // TODO: Omple amb les dades del teu projecte Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyBWAWWLLIiAJc7_w6Is9BbhcjjWZtOQC0",
  authDomain: "emg-fitxes.firebaseapp.com",
  projectId: "emg-fitxes",
  storageBucket: "emg-fitxes.appspot.com",
  messagingSenderId: "1083083243962",
  appId: "1:1083083243962:web:49b6d51dad2aa36abe1d83"
};

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    function getYouTubeEmbed(url) {
      try {
        const u = new URL(url);
        const host = u.hostname.replace("www.", "");
        let id = "";

        if (host.includes("youtu.be")) {
          id = u.pathname.replace("/", "").split("/")[0];
        } else if (host.includes("youtube.com")) {
          if (u.pathname.startsWith("/shorts/")) {
            id = u.pathname.split("/shorts/")[1].split("/")[0];
          } else if (u.pathname.includes("/embed/")) {
            id = u.pathname.split("/embed/")[1].split("/")[0];
          } else {
            id = u.searchParams.get("v");
          }
        }

        if (!id) return null;
        return "https://www.youtube.com/embed/" + id;
      } catch (e) {
        return null;
      }
    }

    function VideoBlock({ url }) {
      if (!url) {
        return (
          <div className="video-placeholder">
            Sense vídeo assignat. Pots enganxar un enllaç de YouTube o Instagram.
          </div>
        );
      }
      const yt = getYouTubeEmbed(url);
      if (yt) {
        return (
          <div className="video-box">
            <iframe
              src={yt}
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowFullScreen
              title="Vídeo del grup"
            />
          </div>
        );
      }
      return (
        <div className="video-placeholder">
          Enllaç: <a href={url} target="_blank" rel="noreferrer">{url}</a>
        </div>
      );
    }

    function BandForm({ onAdd }) {
      const [name, setName] = useState("");
      const [style, setStyle] = useState("");
      const [origin, setOrigin] = useState("");
      const [cachet, setCachet] = useState("");
      const [videoUrl, setVideoUrl] = useState("");
      const [contact, setContact] = useState("");
      const [proposer, setProposer] = useState("");
      const [originals, setOriginals] = useState(false);
      const [covers, setCovers] = useState(false);

      function handleSubmit(e) {
        e.preventDefault();

        if (!name.trim() || !proposer.trim()) {
          alert("Cal omplir com a mínim: NOM DEL GRUP i QUI HO PROPOSA.");
          return;
        }

        onAdd({
          name: name.trim(),
          style: style.trim(),
          origin: origin.trim(),
          cachet: cachet.trim(),
          videoUrl: videoUrl.trim(),
          contact: contact.trim(),
          proposer: proposer.trim(),
          originals,
          covers,
        });

        setName("");
        setStyle("");
        setOrigin("");
        setCachet("");
        setVideoUrl("");
        setContact("");
        setProposer("");
        setOriginals(false);
        setCovers(false);
      }

      return (
        <div className="panel">
          <div className="panel-title">Afegir grup</div>
          <form onSubmit={handleSubmit}>
            <div className="form-group">
              <label htmlFor="name">Nom del grup *</label>
              <input
                id="name"
                type="text"
                placeholder="Ex: Males Pintes Hardcore"
                value={name}
                onChange={(e) => setName(e.target.value)}
              />
              <div className="hint">
                Nom del grup i Qui ho proposa són obligatoris. La resta de camps són opcionals.
              </div>
            </div>

            <div className="form-row">
              <div className="form-group half">
                <label htmlFor="style">Estil musical</label>
                <input
                  id="style"
                  type="text"
                  placeholder="Punk, metal, ska..."
                  value={style}
                  onChange={(e) => setStyle(e.target.value)}
                />
              </div>
              <div className="form-group half">
                <label htmlFor="origin">D'on són?</label>
                <input
                  id="origin"
                  type="text"
                  placeholder="Olot, Girona, BCN..."
                  value={origin}
                  onChange={(e) => setOrigin(e.target.value)}
                />
              </div>
            </div>

            <div className="form-row">
              <div className="form-group half">
                <label htmlFor="cachet">Catxé aproximat</label>
                <input
                  id="cachet"
                  type="text"
                  placeholder="Ex: 600 €, a negociar..."
                  value={cachet}
                  onChange={(e) => setCachet(e.target.value)}
                />
              </div>
              <div className="form-group half">
                <label htmlFor="video">Vídeo (YouTube / Instagram / altre)</label>
                <input
                  id="video"
                  type="url"
                  placeholder="Enganxa aquí l'enllaç del vídeo"
                  value={videoUrl}
                  onChange={(e) => setVideoUrl(e.target.value)}
                />
              </div>
            </div>

            <div className="form-row">
              <div className="form-group">
                <label>Repertori</label>
                <div className="pill-row">
                  <label>
                    <input
                      type="checkbox"
                      checked={originals}
                      onChange={(e) => setOriginals(e.target.checked)}
                    />{" "}
                    Temes propis
                  </label>
                  <label>
                    <input
                      type="checkbox"
                      checked={covers}
                      onChange={(e) => setCovers(e.target.checked)}
                    />{" "}
                    Covers
                  </label>
                </div>
              </div>
            </div>

            <div className="form-row">
              <div className="form-group half">
                <label htmlFor="contact">Contacte</label>
                <input
                  id="contact"
                  type="text"
                  placeholder="Mail, telèfon, IG..."
                  value={contact}
                  onChange={(e) => setContact(e.target.value)}
                />
              </div>
              <div className="form-group half">
                <label htmlFor="proposer">Qui ho proposa? *</label>
                <input
                  id="proposer"
                  type="text"
                  placeholder="Nom de la persona o col·lectiu"
                  value={proposer}
                  onChange={(e) => setProposer(e.target.value)}
                />
              </div>
            </div>

            <div className="btn-row">
              <button type="submit" className="btn-primary">
                <span>Desar fitxa</span>
              </button>
            </div>
          </form>
        </div>
      );
    }

    function BandCard({ band, isFavorite, onToggleFavorite }) {
      if (!band) {
        return (
          <div className="viewer-card">
            <div className="card-header">
              <h2 className="card-title">Sense grup</h2>
              <span className="badge">fitxa actual</span>
            </div>
            <div className="video-placeholder">
              No hi ha cap grup que coincideixi amb els filtres. Prova d'afegir-ne un o treure filtres.
            </div>
          </div>
        );
      }

      return (
        <div className="viewer-card">
          <div className="card-header">
            <h2 className="card-title">{band.name || "Grup sense nom"}</h2>
            <div style={{ display: "flex", alignItems: "center", gap: "0.25rem" }}>
              <button
                type="button"
                className={"fav-btn" + (isFavorite ? " active" : "")}
                onClick={onToggleFavorite}
                aria-label={isFavorite ? "Treure de preferits" : "Marcar com a preferit"}
              >
                {isFavorite ? "★" : "☆"}
              </button>
              <span className="badge yellow">fitxa actual</span>
            </div>
          </div>
          <div className="row">
            <div>
              <div className="row-label">Estil</div>
              <div className={band.style ? "row-value" : "row-value muted"}>
                {band.style || "Sense info"}
              </div>
            </div>
            <div>
              <div className="row-label">Origen</div>
              <div className={band.origin ? "row-value" : "row-value muted"}>
                {band.origin || "Sense info"}
              </div>
            </div>
          </div>
          <div className="row">
            <div>
              <div className="row-label">Catxé</div>
              <div className={band.cachet ? "row-value" : "row-value muted"}>
                {band.cachet || "Sense info"}
              </div>
            </div>
            <div>
              <div className="row-label">Contacte</div>
              <div className={band.contact ? "row-value" : "row-value muted"}>
                {band.contact || "Sense info"}
              </div>
            </div>
          </div>
          <div className="row">
            <div>
              <div className="row-label">Proposat per</div>
              <div className={band.proposer ? "row-value" : "row-value muted"}>
                {band.proposer || "Sense info"}
              </div>
            </div>
          </div>
          <div className="row">
            <div>
              <div className="row-label">Repertori</div>
              <div className={band.originals || band.covers ? "row-value" : "row-value muted"}>
                {band.originals || band.covers
                  ? [
                      band.originals ? "Temes propis" : null,
                      band.covers ? "Covers" : null,
                    ]
                      .filter(Boolean)
                      .join(" · ")
                  : "Sense info"}
              </div>
            </div>
          </div>
          <VideoBlock url={band.videoUrl} />
        </div>
      );
    }

    function Filters({
      search,
      setSearch,
      styleFilter,
      setStyleFilter,
      sortBy,
      setSortBy,
      bands,
      proposerFilter,
      setProposerFilter,
      repertoryFilter,
      setRepertoryFilter,
      favoritesOnly,
      setFavoritesOnly,
    }) {
      const styles = useMemo(() => {
        const set = new Set();
        bands.forEach((b) => {
          if (b.style) {
            set.add(b.style.trim());
          }
        });
        return Array.from(set).sort((a, b) => a.localeCompare(b));
      }, [bands]);

      return (
        <div className="panel">
          <div className="panel-title">Filtres i ordre</div>
          <div className="filters">
            <div className="form-group">
              <label>Cercar per nom</label>
              <input
                type="text"
                placeholder="Escriu el nom del grup..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            </div>
            <div>
              <label>Estil musical</label>
              <div className="pill-row">
                <button
                  type="button"
                  className={"pill-small" + (styleFilter === "" ? " active" : "")}
                  onClick={() => setStyleFilter("")}
                >
                  Tots
                </button>
                {styles.map((st) => (
                  <button
                    key={st}
                    type="button"
                    className={"pill-small" + (styleFilter === st ? " active" : "")}
                    onClick={() => setStyleFilter(st)}
                  >
                    {st}
                  </button>
                ))}
              </div>
            </div>
            <div className="filters-extra">
              <div>
                <label>Ordre</label>
                <select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value)}
                >
                  <option value="name">Nom</option>
                  <option value="style">Estil</option>
                  <option value="origin">Origen</option>
                  <option value="favorites">Preferits primer</option>
                </select>
              </div>
              <div>
                <label>Filtrar per qui proposa</label>
                <input
                  type="text"
                  placeholder="Nom de la persona o col·lectiu"
                  value={proposerFilter}
                  onChange={(e) => setProposerFilter(e.target.value)}
                />
              </div>
            </div>
            <div className="filters-extra">
              <div>
                <label>Repertori</label>
                <select
                  value={repertoryFilter}
                  onChange={(e) => setRepertoryFilter(e.target.value)}
                >
                  <option value="">Tots</option>
                  <option value="originals">Només temes propis</option>
                  <option value="covers">Només covers</option>
                </select>
              </div>
              <div>
                <label>
                  <input
                    type="checkbox"
                    checked={favoritesOnly}
                    onChange={(e) => setFavoritesOnly(e.target.checked)}
                  />{" "}
                  Només preferits
                </label>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function ListView({ bands, setBands }) {
      const [search, setSearch] = useState("");
      const [styleFilter, setStyleFilter] = useState("");
      const [proposerFilter, setProposerFilter] = useState("");
      const [sortBy, setSortBy] = useState("name");
      const [index, setIndex] = useState(0);

      const [favorites, setFavorites] = useState(() => {
        if (typeof window === "undefined") return [];
        try {
          const raw = window.localStorage.getItem("emg_favorites");
          return raw ? JSON.parse(raw) : [];
        } catch (e) {
          return [];
        }
      });
      const [favoritesOnly, setFavoritesOnly] = useState(false);
      const [repertoryFilter, setRepertoryFilter] = useState("");


      const [isEditing, setIsEditing] = useState(false);
      const [editName, setEditName] = useState("");
      const [editStyle, setEditStyle] = useState("");
      const [editOrigin, setEditOrigin] = useState("");
      const [editCachet, setEditCachet] = useState("");
      const [editVideoUrl, setEditVideoUrl] = useState("");
      const [editContact, setEditContact] = useState("");
      const [editProposer, setEditProposer] = useState("");
      const [editOriginals, setEditOriginals] = useState(false);
      const [editCovers, setEditCovers] = useState(false);

      function handleExport() {
        if (!bands.length) {
          alert("No hi ha cap grup per exportar.");
          return;
        }
        const headers = [
          "Nom del grup",
          "Estil musical",
          "Origen",
          "Catxé",
          "Contacte",
          "Qui ho proposa",
          "Vídeo"
        ];
        const rows = bands.map((b) => [
          b.name || "",
          b.style || "",
          b.origin || "",
          b.cachet || "",
          b.contact || "",
          b.proposer || "",
          b.videoUrl || ""
        ]);
        const escape = (value) => {
          const v = (value ?? "").toString().replace(/"/g, '""');
          return `"${v}"`;
        };
        const csv = [
          headers.map(escape).join(","),
          ...rows.map((r) => r.map(escape).join(","))
        ].join("\r\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "espai-musics-garrotxa-fitxes.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function handleShare(current) {
        if (!current) {
          alert("Cap fitxa seleccionada per compartir.");
          return;
        }

        const b = current;
        let text = `FITXA DE GRUP - ESPAI MÚSICS GARROTXA\n\n`;
        text += `Nom: ${b.name || "-"}\n`;
        text += `Estil: ${b.style || "-"}\n`;
        text += `Origen: ${b.origin || "-"}\n`;
        const rep = [];
        if (b.originals) rep.push("temes propis");
        if (b.covers) rep.push("covers");
        if (rep.length > 0) {
          text += `Repertori: ${rep.join(" + ")}\n`;
        }
        if (b.cachet) text += `\nCatxé: ${b.cachet}`;
        if (b.contact) text += `\nContacte: ${b.contact}`;
        if (b.proposer) text += `\nProposat per: ${b.proposer}`;
        if (b.videoUrl) text += `\nVídeo: ${b.videoUrl}`;

        const url = window.location.href;
        const fullText = text + "\n\n" + url;

        if (navigator.share) {
          navigator.share({
            title: b.name || "Fitxa de grup",
            text: fullText,
            url
          }).catch(() => {});
        } else {
          const waUrl = "https://wa.me/?text=" + encodeURIComponent(fullText);
          window.open(waUrl, "_blank");
        }
      }

      const filtered = useMemo(() => {
        let list = [...bands];

        // Text & estil
        if (search.trim() !== "") {
          const q = search.toLowerCase();
          list = list.filter((b) =>
            (b.name || "").toLowerCase().includes(q)
          );
        }

        if (styleFilter) {
          const q = styleFilter.toLowerCase();
          list = list.filter((b) => (b.style || "").toLowerCase() === q);
        }

        if (proposerFilter.trim() !== "") {
          const q = proposerFilter.toLowerCase();
          list = list.filter((b) => (b.proposer || "").toLowerCase().includes(q));
        }

        if (repertoryFilter === "originals") {
          list = list.filter((b) => !!b.originals);
        } else if (repertoryFilter === "covers") {
          list = list.filter((b) => !!b.covers);
        }

        if (favoritesOnly) {
          list = list.filter((b) => favorites.includes(b.id));
        }

        // Ordenació
        list.sort((a, b) => {
          if (sortBy === "favorites") {
            const af = favorites.includes(a.id) ? 0 : 1;
            const bf = favorites.includes(b.id) ? 0 : 1;
            if (af !== bf) return af - bf;
            const an = (a.name || "").toLowerCase();
            const bn = (b.name || "").toLowerCase();
            return an.localeCompare(bn);
          }

          const field = sortBy === "name" ? "name" : sortBy === "style" ? "style" : "origin";
          const av = (a[field] || "").toLowerCase();
          const bv = (b[field] || "").toLowerCase();
          if (av < bv) return -1;
          if (av > bv) return 1;
          return 0;
        });

        return list;
      }, [bands, search, styleFilter, proposerFilter, sortBy, favorites, favoritesOnly, repertoryFilter]);

      useEffect(() => {
        setIndex(0);
        setIsEditing(false);
      }, [search, styleFilter, proposerFilter, sortBy, bands.length, favoritesOnly, repertoryFilter]);

      const current = filtered.length > 0 ? filtered[Math.min(index, filtered.length - 1)] : null;

      useEffect(() => {
        if (typeof window === "undefined") return;
        try {
          window.localStorage.setItem("emg_favorites", JSON.stringify(favorites));
        } catch (e) {}
      }, [favorites]);


      function toggleFavorite(band) {
        if (!band || !band.id) return;
        setFavorites((prev) =>
          prev.includes(band.id)
            ? prev.filter((id) => id !== band.id)
            : [...prev, band.id]
        );
      }

      function startEdit() {
        if (!current) return;
        setEditName(current.name || "");
        setEditStyle(current.style || "");
        setEditOrigin(current.origin || "");
        setEditCachet(current.cachet || "");
        setEditVideoUrl(current.videoUrl || "");
        setEditContact(current.contact || "");
        setEditProposer(current.proposer || "");
        setEditOriginals(!!current.originals);
        setEditCovers(!!current.covers);
        setIsEditing(true);
      }

      function cancelEdit() {
        setIsEditing(false);
      }

      function handleUpdate(e) {
        e.preventDefault();
        if (!current) return;

        if (!editName.trim() || !editProposer.trim()) {
          alert("Cal omplir com a mínim: NOM DEL GRUP i QUI HO PROPOSA.");
          return;
        }

        const updated = {
          name: editName.trim(),
          style: editStyle.trim(),
          origin: editOrigin.trim(),
          cachet: editCachet.trim(),
          videoUrl: editVideoUrl.trim(),
          contact: editContact.trim(),
          proposer: editProposer.trim(),
          originals: editOriginals,
          covers: editCovers,
        };

        db.collection("bands")
          .doc(current.id)
          .update(updated)
          .then(() => {
            setBands((prev) =>
              prev.map((b) => (b.id === current.id ? { ...b, ...updated } : b))
            );
            setIsEditing(false);
            alert("Fitxa actualitzada!");
          })
          .catch((error) => {
            console.error("Error actualitzant la fitxa", error);
            alert("No s'ha pogut actualitzar la fitxa a la base de dades.");
          });
      }

      function goPrev() {
        setIndex((i) => (i > 0 ? i - 1 : 0));
      }

      function goNext() {
        setIndex((i) => (i < filtered.length - 1 ? i + 1 : i));
      }

      function handleDelete() {
        if (!current) return;
        if (!window.confirm("Segur que vols esborrar aquesta fitxa?")) return;
        db.collection("bands")
          .doc(current.id)
          .delete()
          .then(() => {
            setIndex(0);
          })
          .catch((error) => {
            console.error("Error esborrant de Firestore", error);
            alert("No s'ha pogut esborrar la fitxa de la base de dades.");
          });
      }

      return (
        <div className="page-wrap">
          <h2 className="page-title">Grups</h2>
          <p className="page-sub">
            Navega per les fitxes, canvia l'ordre i elimina les que ja no t'interessin.
          </p>
          <div className="page-grid">
            <div>
              <Filters
                search={search}
                setSearch={setSearch}
                styleFilter={styleFilter}
                setStyleFilter={setStyleFilter}
                sortBy={sortBy}
                setSortBy={setSortBy}
                bands={bands}
                proposerFilter={proposerFilter}
                setProposerFilter={setProposerFilter}
                repertoryFilter={repertoryFilter}
                setRepertoryFilter={setRepertoryFilter}
                favoritesOnly={favoritesOnly}
                setFavoritesOnly={setFavoritesOnly}
              />
              <div style={{ marginTop: "0.8rem" }}>
                <button className="export-btn" type="button" onClick={handleExport}>
                  Exportar en CSV
                </button>
              </div>
            </div>
            <div>
              <div className="list-toolbar">
                <div className="list-toolbar-main">
                  <button
                    type="button"
                    className="nav-btn"
                    onClick={goPrev}
                    disabled={index === 0 || filtered.length === 0}
                  >
                    ◀
                  </button>
                  <button
                    type="button"
                    className="nav-btn"
                    onClick={goNext}
                    disabled={index >= filtered.length - 1 || filtered.length === 0}
                  >
                    ▶
                  </button>
                  <span className="counter">
                    {filtered.length === 0
                      ? "0 / 0"
                      : `${Math.min(index + 1, filtered.length)} / ${filtered.length}`}
                  </span>
                </div>
                <div style={{ display: "flex", gap: "0.4rem", alignItems: "center", flexWrap: "wrap" }}>
                  <button
                    type="button"
                    className="share-btn"
                    onClick={() => handleShare(current)}
                    disabled={!current}
                  >
                    Compartir fitxa
                  </button>
                  <button
                    type="button"
                    className="edit-btn"
                    onClick={startEdit}
                    disabled={!current}
                  >
                    Editar
                  </button>
                  <button
                    type="button"
                    className="delete-btn"
                    onClick={handleDelete}
                    disabled={!current}
                  >
                    Esborrar
                  </button>
                </div>
              </div>
              {filtered.length === 0 ? (
                <p className="no-bands">
                  Encara no hi ha grups que coincideixin amb els filtres. Prova de treure filtres o afegeix alguna fitxa.
                </p>
              ) : isEditing && current ? (
                <form className="panel edit-form" onSubmit={handleUpdate}>
                  <div className="panel-title">Editar fitxa</div>

                  <div className="form-group">
                    <label>Nom del grup *</label>
                    <input
                      type="text"
                      value={editName}
                      onChange={(e) => setEditName(e.target.value)}
                    />
                  </div>

                  <div className="form-row">
                    <div className="form-group half">
                      <label>Estil musical</label>
                      <input
                        type="text"
                        value={editStyle}
                        onChange={(e) => setEditStyle(e.target.value)}
                      />
                    </div>
                    <div className="form-group half">
                      <label>Origen</label>
                      <input
                        type="text"
                        value={editOrigin}
                        onChange={(e) => setEditOrigin(e.target.value)}
                      />
                    </div>
                  </div>

                  <div className="form-row">
                    <div className="form-group half">
                      <label>Catxé aproximat</label>
                      <input
                        type="text"
                        value={editCachet}
                        onChange={(e) => setEditCachet(e.target.value)}
                      />
                    </div>
                    <div className="form-group half">
                      <label>Vídeo (YouTube / Instagram / altre)</label>
                      <input
                        type="url"
                        value={editVideoUrl}
                        onChange={(e) => setEditVideoUrl(e.target.value)}
                      />
                    </div>
                  </div>

                  <div className="form-row">
                    <div className="form-group">
                      <label>Repertori</label>
                      <div className="pill-row">
                        <label>
                          <input
                            type="checkbox"
                            checked={editOriginals}
                            onChange={(e) => setEditOriginals(e.target.checked)}
                          />{" "}
                          Temes propis
                        </label>
                        <label>
                          <input
                            type="checkbox"
                            checked={editCovers}
                            onChange={(e) => setEditCovers(e.target.checked)}
                          />{" "}
                          Covers
                        </label>
                      </div>
                    </div>
                  </div>

                  <div className="form-row">
                    <div className="form-group half">
                      <label>Contacte</label>
                      <input
                        type="text"
                        value={editContact}
                        onChange={(e) => setEditContact(e.target.value)}
                      />
                    </div>
                    <div className="form-group half">
                      <label>Qui ho proposa *</label>
                      <input
                        type="text"
                        value={editProposer}
                        onChange={(e) => setEditProposer(e.target.value)}
                      />
                    </div>
                  </div>

                  <div className="edit-form-actions">
                    <button type="submit" className="btn-primary">
                      Desar canvis
                    </button>
                    <button type="button" className="btn-ghost" onClick={cancelEdit}>
                      Cancel·lar
                    </button>
                  </div>
                </form>
              ) : (
                <BandCard
                  band={current}
                  isFavorite={current ? favorites.includes(current.id) : false}
                  onToggleFavorite={() => toggleFavorite(current)}
                />
              )}
            </div>
          </div>
        </div>
      );
    }

    
function HomeView({ goAdd, goList, associacio }) {
      return (
        <div className="page-wrap">
          <div className="home-hero">
            <div className="home-hero-overlay" />
            <div className="home-hero-inner">
              <h1 className="home-hero-title">
                {associacio?.nom || "Tink Ànsies"}
              </h1>
              <div className="home-hero-bursts">
                <button className="burst-btn" type="button" onClick={goAdd}>
                  <div className="burst-btn-inner">
                    <div className="burst-main">AFEGIR GRUP</div>
                  </div>
                </button>
                <button className="burst-btn" type="button" onClick={goList}>
                  <div className="burst-btn-inner">
                    <div className="burst-main">GRUPS</div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function AddView({ bands, onAdd }) {
      return (
        <div className="page-wrap">
          <h2 className="page-title">Afegir grup</h2>
          <p className="page-sub">
            Omple les dades que vulguis. Nom del grup i Qui ho proposa són obligatoris; la resta és opcional.
          </p>
          <div className="page-grid">
            <div>
              <BandForm onAdd={onAdd} />
            </div>
            <div>
              <div className="panel">
                <div className="panel-title">Recordatori</div>
                <p className="hint">
                  Quan afegeixis un grup, apareixerà a la llista de <strong>GRUPS</strong>. Des d'allà el podràs
                  veure, passar fitxes i esborrar si cal.
                </p>
                <p className="hint">
                  Ara mateix tens <strong>{bands.length}</strong> grup(s) guardats a la base de dades compartida.
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }


    function LoginAssociacio({ onLogin }) {
      const [codi, setCodi] = useState("");
      const [error, setError] = useState("");
      const [loading, setLoading] = useState(false);

      async function handleSubmit(e) {
        e.preventDefault();
        if (!codi.trim()) return;
        setError("");
        setLoading(true);
        try {
          const snap = await db
            .collection("associacions")
            .where("codiAcces", "==", codi.trim())
            .limit(1)
            .get();

          if (snap.empty) {
            setError("Codi incorrecte");
            setLoading(false);
            return;
          }

          const doc = snap.docs[0];
          const data = doc.data() || {};
          const id = doc.id;
          const nom = data.nom || doc.id;

          onLogin({ id, nom });
          setLoading(false);
        } catch (err) {
          console.error("Error iniciant sessió d'associació", err);
          setError("Error de connexió. Torna-ho a provar.");
          setLoading(false);
        }
      }

      return (
        <div
          style={{
            minHeight: "100vh",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            backgroundColor: "#000",
            padding: "1.5rem"
          }}
        >
          <form
            onSubmit={handleSubmit}
            style={{
              width: "100%",
              maxWidth: "360px",
              background:
                "radial-gradient(circle at top, rgba(255,235,59,0.12), transparent 55%), #050505",
              borderRadius: "20px",
              border: "1px solid rgba(255,255,255,0.16)",
              padding: "1.5rem 1.4rem",
              boxShadow:
                "0 24px 60px rgba(0,0,0,0.95), 0 0 0 1px rgba(255,255,255,0.03)",
              color: "#fff"
            }}
          >
            <div style={{ display: "flex", alignItems: "center", gap: "0.75rem", marginBottom: "1.25rem" }}>
              <div
                style={{
                  width: 42,
                  height: 42,
                  borderRadius: "999px",
                  border: "2px solid rgba(255,235,59,0.8)",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  background:
                    "radial-gradient(circle at 30% 0%, rgba(255,235,59,0.95), rgba(255,160,0,0.2))",
                  boxShadow: "0 0 18px rgba(255,235,59,0.7)"
                }}
              >
                <img
                  src="icons/emg-icon-192.png"
                  alt="EMG"
                  style={{ width: 28, height: 28, objectFit: "contain" }}
                />
              </div>
              <div>
                <div
                  style={{
                    fontSize: "0.9rem",
                    textTransform: "uppercase",
                    letterSpacing: "0.16em",
                    fontWeight: 700
                  }}
                >
                  Tink Ànsies
                </div>
                <div
                  style={{
                    fontSize: "0.7rem",
                    letterSpacing: "0.18em",
                    textTransform: "uppercase",
                    color: "#bbbbbb"
                  }}
                >
                  accés per associacions
                </div>
              </div>
            </div>

            <label
              style={{
                display: "block",
                fontSize: "0.75rem",
                textTransform: "uppercase",
                letterSpacing: "0.16em",
                marginBottom: "0.35rem",
                color: "#bbbbbb"
              }}
            >
              Codi d'associació
            </label>
            <input
              type="password"
              value={codi}
              onChange={(e) => setCodi(e.target.value)}
              placeholder="Introdueix el codi"
              style={{
                width: "100%",
                borderRadius: "999px",
                border: "1px solid rgba(255,255,255,0.2)",
                padding: "0.6rem 0.9rem",
                background: "rgba(0,0,0,0.85)",
                color: "#fff",
                fontSize: "0.9rem",
                outline: "none",
                marginBottom: "0.65rem"
              }}
            />
            <button
              type="submit"
              disabled={loading || !codi.trim()}
              style={{
                width: "100%",
                borderRadius: "999px",
                border: "none",
                padding: "0.65rem 1rem",
                marginTop: "0.1rem",
                background: loading
                  ? "#444"
                  : "linear-gradient(135deg, #ff0000, #ff9800)",
                color: "#000",
                fontSize: "0.8rem",
                fontWeight: 700,
                textTransform: "uppercase",
                letterSpacing: "0.16em",
                cursor: loading || !codi.trim() ? "default" : "pointer",
                boxShadow: loading
                  ? "none"
                  : "0 14px 32px rgba(0,0,0,0.9), 0 0 16px rgba(255,235,59,0.8)"
              }}
            >
              {loading ? "Entrant..." : "Entrar"}
            </button>

            {error && (
              <p
                style={{
                  marginTop: "0.7rem",
                  fontSize: "0.8rem",
                  color: "#ff8a80"
                }}
              >
                {error}
              </p>
            )}

            <p
              style={{
                marginTop: "0.9rem",
                fontSize: "0.7rem",
                color: "#999",
                lineHeight: 1.4
              }}
            >
              Cada associació té el seu propi codi i només veu les seves fitxes.
            </p>
          </form>
        </div>
      );
    }

    function App({ associacio, onLogout }) {
      const [view, setView] = useState("home");
      const [bands, setBands] = useState([]);

      useEffect(() => {
        if (!associacio || !associacio.id) return;
        const unsubscribe = db
          .collection("bands")
          .where("associacioId", "==", associacio.id)
          .onSnapshot(
            (snapshot) => {
              const docs = snapshot.docs.map((doc) => ({
                id: doc.id,
                ...doc.data(),
              }));
              setBands(docs);
            },
            (error) => {
              console.error("Error llegint Firestore", error);
            }
          );
        return () => unsubscribe();
      }, [associacio]);

      function handleAdd(band) {
        const { id, ...data } = band;
        if (!associacio || !associacio.id) {
          alert("Cap associació seleccionada.");
          return;
        }
        db.collection("bands")
          .add({
            ...data,
            associacioId: associacio.id,
            createdAt: new Date(),
          })
          .then(() => {
            setView("list");
          })
          .catch((error) => {
            console.error("Error desant a Firestore", error);
            alert("Hi ha hagut un error desant la fitxa a la base de dades.");
          });
      }

      return (
        <div className="app-shell">
          <div className="top-bar">
            <div className="top-left">
              <div className="top-logo">
                <img src="icons/logo-tinkansies.png" alt="Tink Ànsies" />
              </div>
              <div>
                <div className="top-title">Tink Ànsies</div>
                <div className="top-badge">
                  fitxes de grups · associació: {associacio.nom}
                </div>
              </div>
            </div>
            <div className="top-nav">
              <button
                className={"top-nav-btn" + (view === "home" ? " active" : "")}
                onClick={() => setView("home")}
              >
                <span className="dot" />
                Inici
              </button>
              <button
                className={"top-nav-btn" + (view === "add" ? " active" : "")}
                onClick={() => setView("add")}
              >
                <span className="dot" />
                Afegir
              </button>
              <button
                className={"top-nav-btn" + (view === "list" ? " active" : "")}
                onClick={() => setView("list")}
              >
                <span className="dot" />
                Grups
              </button>
              <button
                className="top-nav-btn"
                type="button"
                onClick={onLogout}
              >
                <span className="dot" />
                Sortir
              </button>
            </div>
          </div>

          {view === "home" && (
            <HomeView
              goAdd={() => setView("add")}
              goList={() => setView("list")}
              associacio={associacio}
            />
          )}
          {view === "add" && <AddView bands={bands} onAdd={handleAdd} />}
          {view === "list" && <ListView bands={bands} setBands={setBands} />}
        </div>
      );
    }

    function RootApp() {
      const [associacio, setAssociacio] = useState(null);

      useEffect(() => {
        try {
          const id = window.localStorage.getItem("associacioId");
          const nom = window.localStorage.getItem("associacioNom");
          if (id && nom) {
            setAssociacio({ id, nom });
          }
        } catch (e) {
          console.error("Error llegint associació des de localStorage", e);
        }
      }, []);

      function handleLogin(info) {
        try {
          window.localStorage.setItem("associacioId", info.id);
          window.localStorage.setItem("associacioNom", info.nom);
        } catch (e) {
          console.error("Error guardant associació al localStorage", e);
        }
        setAssociacio({ id: info.id, nom: info.nom });
      }

      function handleLogout() {
        try {
          window.localStorage.removeItem("associacioId");
          window.localStorage.removeItem("associacioNom");
        } catch (e) {
          console.error("Error netejant localStorage", e);
        }
        setAssociacio(null);
      }

      if (!associacio) {
        return <LoginAssociacio onLogin={handleLogin} />;
      }

      return <App associacio={associacio} onLogout={handleLogout} />;
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<RootApp />);

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch((err) => {
          console.error("SW error", err);
        });
      });
    }
  </script>
</body>
</html>
